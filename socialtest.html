<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DRFMedia Social</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f2f5;
    }
    header {
      background: #4267B2;
      color: white;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .container {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      flex-wrap: wrap;
    }
    .sidebar, .feed, .rightbar {
      background: white;
      padding: 1rem;
      border-radius: 8px;
    }
    .sidebar, .rightbar { flex: 1 1 100%; }
    .feed { flex: 2 1 100%; }
    @media(min-width: 768px) {
      .sidebar, .rightbar { flex: 1; }
      .feed { flex: 2; }
    }
    .drag-drop {
      border: 2px dashed #ccc;
      padding: 1rem;
      text-align: center;
      margin-top: 0.5rem;
      border-radius: 8px;
      cursor: pointer;
    }
    .post img, .post video {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 0.5rem;
    }
    input, textarea {
      width: 100%;
      padding: 0.5rem;
      margin: 0.5rem 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 0.5rem 1rem;
      background: #4267B2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #365899;
    }
    .reaction-bar {
      display: flex;
      justify-content: space-between;
      margin-top: 0.5rem;
    }
    .reaction-bar button {
      background: transparent;
      color: #4267B2;
      border: none;
      cursor: pointer;
    }
    .comment-box {
      display: none;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>

<header>
  <h1>DRFMedia</h1>
  <span>Decentralized Social DApp</span>
</header>

<div class="container">
  <div class="sidebar">
    <h2>Your Profile</h2>
    <img class="profile-photo" id="profilePhoto" src="https://via.placeholder.com/150" alt="Profile Photo" style="width: 100%; border-radius: 8px;">
    <p><strong>Name:</strong> <span id="displayName">Anonymous</span></p>
    <p><strong>Bio:</strong> <span id="bio">No bio yet.</span></p>
    <button onclick="editProfile()">Edit Profile</button>
  </div>

  <div class="feed">
    <h2>Create Post</h2>
    <textarea id="postText" placeholder="What's on your mind?"></textarea>

    <div class="drag-drop" id="dropZone">üìÅ Drag & Drop Image or Video Here</div>
    <input type="file" id="postMedia" accept="image/*,video/*" style="display:none;">

    <button onclick="createPost()">Post</button>

    <h2>Posts</h2>
    <div id="postList"></div>
  </div>

  <div class="rightbar">
    <h2>Request Donation</h2>
    <textarea id="donationDesc" placeholder="Why do you need a donation?"></textarea>
    <input type="number" id="donationAmount" placeholder="Amount Requested in DRFM">
    <button onclick="requestDonation()">Request</button>
    <h2>Donation Requests</h2>
    <div id="donationList"></div>
  </div>
</div>

<script>
  const API_KEY = "9983d49b.7d01108f38fb448db6b45bf24c46603b";
  let selectedFile = null;
  const postList = document.getElementById("postList");
  const dropZone = document.getElementById("dropZone");
  const postMedia = document.getElementById("postMedia");

  dropZone.addEventListener('click', () => postMedia.click());
  postMedia.addEventListener('change', (e) => selectedFile = e.target.files[0]);

  dropZone.addEventListener("dragover", e => {
    e.preventDefault();
    dropZone.style.background = "#e6f7ff";
  });

  dropZone.addEventListener("dragleave", () => {
    dropZone.style.background = "";
  });

  dropZone.addEventListener("drop", e => {
    e.preventDefault();
    selectedFile = e.dataTransfer.files[0];
    dropZone.textContent = `Selected: ${selectedFile.name}`;
  });

  async function uploadToNFTStorage(file) {
    const formData = new FormData();
    formData.append("file", file);
    const res = await fetch("https://api.nft.storage/upload", {
      method: "POST",
      headers: { Authorization: `Bearer ${API_KEY}` },
      body: formData
    });
    const data = await res.json();
    if (!data.ok) throw new Error("Upload failed");
    return `https://ipfs.io/ipfs/${data.value.cid}`;
  }

  async function createPost() {
    const postText = document.getElementById("postText").value;
    if (!postText && !selectedFile) {
      alert("Post cannot be empty.");
      return;
    }

    let mediaURL = null;
    if (selectedFile) {
      dropZone.textContent = "Uploading to IPFS...";
      try {
        mediaURL = await uploadToNFTStorage(selectedFile);
        dropZone.textContent = "üìÅ Drag & Drop Image or Video Here";
      } catch (e) {
        alert("Upload failed: " + e.message);
        return;
      }
    }

    const postDiv = document.createElement("div");
    postDiv.className = "post";
    postDiv.innerHTML = `<p><strong>${document.getElementById("displayName").innerText}:</strong> ${postText}</p>`;
    if (mediaURL) {
      if (selectedFile.type.startsWith("image/")) {
        postDiv.innerHTML += `<img src="${mediaURL}" alt="Post Image">`;
      } else if (selectedFile.type.startsWith("video/")) {
        postDiv.innerHTML += `<video controls><source src="${mediaURL}" type="${selectedFile.type}"></video>`;
      }
    }

    postDiv.innerHTML += `
      <div class="reaction-bar">
        <button onclick="likePost(this)"><i class="fa fa-thumbs-up"></i> Like</button>
        <button onclick="commentPost(this)">Comment</button>
      </div>
      <div class="comment-box">
        <input type="text" placeholder="Write a comment..." onkeydown="submitComment(event, this)">
      </div>
    `;
    postList.prepend(postDiv);
    document.getElementById("postText").value = "";
    selectedFile = null;
  }

  function likePost(btn) {
    if (btn.innerHTML.includes("Like")) {
      btn.innerHTML = `<i class="fa fa-thumbs-up"></i> Liked`;
      btn.style.color = "#065fe6";
    } else {
      btn.innerHTML = `<i class="fa fa-thumbs-up"></i> Like`;
      btn.style.color = "#4267B2";
    }
  }

  function commentPost(btn) {
    const box = btn.closest(".post").querySelector(".comment-box");
    box.style.display = box.style.display === "none" ? "block" : "none";
  }

  function submitComment(e, input) {
    if (e.key === "Enter") {
      const text = input.value.trim();
      if (text) {
        const div = document.createElement("div");
        div.className = "comment";
        div.textContent = `${document.getElementById("displayName").innerText}: ${text}`;
        input.parentElement.appendChild(div);
        input.value = "";
      }
    }
  }

  function editProfile() {
    const name = prompt("Enter display name:");
    const bio = prompt("Enter bio:");
    document.getElementById("displayName").innerText = name || "Anonymous";
    document.getElementById("bio").innerText = bio || "No bio yet.";
  }

  function requestDonation() {
    const desc = document.getElementById("donationDesc").value;
    const amount = document.getElementById("donationAmount").value;
    if (!desc || !amount) return alert("Fill both fields.");
    const div = document.createElement("div");
    div.className = "donation";
    div.innerHTML = `<p><strong>${document.getElementById("displayName").innerText}</strong> requests <strong>${amount} DRFM</strong></p><p>${desc}</p>`;
    document.getElementById("donationList").prepend(div);
  }
</script>
</body>
</html>
