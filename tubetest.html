<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Watch on DRFTube</title>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 20px;
      text-align: center;
    }
    video {
      width: 90%;
      max-width: 720px;
      border-radius: 12px;
      margin-top: 20px;
    }
    .title {
      font-size: 1.5rem;
      color: #0af;
      margin-top: 20px;
    }
    .description {
      font-size: 1rem;
      color: #ccc;
      margin-top: 10px;
    }
    .back-link {
      color: #0af;
      display: inline-block;
      margin-top: 20px;
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <div id="content"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCdFX1PbNEgubM4Zib7U-hgtJbSOONPk6U",
      authDomain: "drftube-634c6.firebaseapp.com",
      projectId: "drftube-634c6",
      storageBucket: "drftube-634c6.appspot.com",
      messagingSenderId: "819828633864",
      appId: "1:819828633864:web:513002b461259b000cbcbd",
      measurementId: "G-ZPTJE4DMNN",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const content = document.getElementById('content');

    const urlParams = new URLSearchParams(window.location.search);
    const hash = urlParams.get('hash');

    if (!hash) {
      content.innerHTML = `
        <h2>❌ No video hash provided in the URL.</h2>
        <a href="videos.html" class="back-link">← Back to Videos</a>
      `;
    } else {
      loadVideo(hash);
    }

    async function loadVideo(hash) {
      content.innerHTML = `<p>Loading video...</p>`;

      try {
        const snapshot = await getDocs(collection(db, "videos"));
        let found = null;
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.ipfsHash === hash) {
            found = data;
          }
        });

        if (!found) {
          content.innerHTML = `<h2>❌ Video not found in database.</h2><a href="videos.html" class="back-link">← Back to Videos</a>`;
          return;
        }

        const title = found.title || "Untitled Video";
        const description = found.description || "";

        const videoURL = `https://gateway.pinata.cloud/ipfs/${hash}`;

        content.innerHTML = `
          <h2 class="title">${title}</h2>
          <video src="${videoURL}" controls autoplay></video>
          <p class="description">${description}</p>
          <a href="videos.html" class="back-link">← Back to Videos</a>
        `;
      } catch (err) {
        content.innerHTML = `<h2>⚠️ Failed to load video: ${err.message}</h2>`;
      }
    }
  </script>

</body>
</html>
