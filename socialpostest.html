<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DRFMedia Timeline</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
    .card { background: white; padding: 15px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; }
    button { padding: 10px 20px; background: #3a8ee6; color: white; border: none; border-radius: 5px; cursor: pointer; }
    video, img { max-width: 100%; border-radius: 10px; margin-top: 10px; }
  </style>
</head>
<body>

<h2>ðŸ“¸ DRFMedia Post</h2>

<div class="card">
  <input type="file" id="mediaFile" accept="image/*,video/*">
  <textarea id="caption" placeholder="Write your caption..."></textarea>
  <button onclick="uploadPost()">Post Now</button>
</div>

<h3>ðŸ“° Timeline</h3>
<div id="timeline"></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-database-compat.js"></script>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyB-W_j74lsbmJUFnTbJpn79HM62VLmkQC8",
    authDomain: "drfsocial-23a06.firebaseapp.com",
    databaseURL: "https://drfsocial-23a06-default-rtdb.firebaseio.com",
    projectId: "drfsocial-23a06",
    storageBucket: "drfsocial-23a06.appspot.com",
    messagingSenderId: "608135115201",
    appId: "1:608135115201:web:dc999df2c0f37241ff3f40",
    measurementId: "G-W6VHMP77YR"
  };

  // Init Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const pinataJWT = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiI4MDFmMDAxNy04YjZkLTQ2YjYtOGIwZi04Y2NkZWU5NzE4ODIiLCJlbWFpbCI6ImRpZ2l0YWxydWZpeWFAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsInBpbl9wb2xpY3kiOnsicmVnaW9ucyI6W3siZGVzaXJlZFJlcGxpY2F0aW9uQ291bnQiOjEsImlkIjoiRlJBMSJ9LHsiZGVzaXJlZFJlcGxpY2F0aW9uQ291bnQiOjEsImlkIjoiTllDMSJ9XSwidmVyc2lvbiI6MX0sIm1mYV9lbmFibGVkIjpmYWxzZSwic3RhdHVzIjoiQUNUSVZFIn0sImF1dGhlbnRpY2F0aW9uVHlwZSI6InNjb3BlZEtleSIsInNjb3BlZEtleUtleSI6IjNkODdmOWVkOTA0ZGY4OTI2NTRjIiwic2NvcGVkS2V5U2VjcmV0IjoiYTI3OWU4ODU0ZDQ0YWY2Y2IxNzA0N2RhOThhYTc3MmExOTAyMmFhYTIwOTQ5YjEzN2Y5ZmIxMDI3YzAzYmY5ZiIsImV4cCI6MTc4MDQyMzA3Mn0.YpqewbjW7gAVyPSKYiO9Ym9QhddKc_1vm8CJIoXDQyA";

  async function uploadPost() {
    const fileInput = document.getElementById("mediaFile");
    const caption = document.getElementById("caption").value;
    if (!fileInput.files[0]) return alert("Please select a file");
    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    const res = await fetch("https://api.pinata.cloud/pinning/pinFileToIPFS", {
      method: "POST",
      headers: {
        Authorization: `Bearer ${pinataJWT}`
      },
      body: formData
    });

    const data = await res.json();
    const cid = data.IpfsHash;
    const fileUrl = `https://gateway.pinata.cloud/ipfs/${cid}`;
    const type = fileInput.files[0].type.startsWith("video") ? "video" : "image";

    const post = {
      type,
      fileUrl,
      caption,
      timestamp: Date.now()
    };

    await db.ref("posts").push(post);
    alert("âœ… Post Uploaded!");
    fileInput.value = "";
    caption.value = "";
    loadPosts();
  }

  function loadPosts() {
    const container = document.getElementById("timeline");
    container.innerHTML = "";
    db.ref("posts").orderByChild("timestamp").once("value", snapshot => {
      const posts = [];
      snapshot.forEach(child => posts.push(child.val()));
      posts.reverse().forEach(post => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <p>${post.caption}</p>
          ${post.type === "video"
            ? `<video controls src="${post.fileUrl}"></video>`
            : `<img src="${post.fileUrl}" />`}
          <small>${new Date(post.timestamp).toLocaleString()}</small>
        `;
        container.appendChild(card);
      });
    });
  }

  window.onload = loadPosts;
</script>

</body>
</html>
