<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport"content="width=device-width,initial-scale=1"/>
  <title>DRF Wallet Transactions</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body style="font-family:Arial;text-align:center;background:#f4f9fb;padding:20px;">
  <h2>Transaction History</h2>
  <p id="addr" style="font-weight:bold;"></p>
  <div id="txList" style="max-width:600px;margin:auto;text-align:left;"></div>
  <br/><a href="dashboard.html">← Back to Dashboard</a>

<script>
// get your BscScan API key here:
const API_KEY = "Your_BSCSCAN_API_KEY";

async function loadTxs(){
  const enc = sessionStorage.getItem("drf_wallet_json")||localStorage.getItem("drf_encrypted_wallet");
  if(!enc) return location.href="index.html";
  const pw = sessionStorage.getItem("drf_wallet_pw");
  const wallet = await ethers.Wallet.fromEncryptedJson(enc,pw);
  const addr = wallet.address;
  document.getElementById("addr").innerText="Address: "+addr;

  const resp = await fetch(
    `https://api.bscscan.com/api?module=account&action=txlist&address=${addr}&startblock=0&endblock=99999999&sort=desc&apikey=${API_KEY}`
  );
  const data = await resp.json();
  const list = document.getElementById("txList");
  if(data.status!=="1"){ list.innerText="No transactions found."; return; }
  data.result.slice(0,20).forEach(tx=>{
    const row = document.createElement("div");
    row.style.margin="8px 0";
    row.innerHTML = `
      <strong>${tx.isError==="0"?"✅":"❌"}</strong>
      <a href="https://bscscan.com/tx/${tx.hash}" target="_blank">${tx.hash.substr(0,20)}…</a>
      <br/>Value: ${ethers.utils.formatEther(tx.value||"0")} BNB
      <br/>Block: ${tx.blockNumber}
      <hr/>
    `;
    list.appendChild(row);
  });
}
loadTxs();
</script>
</body>
</html>
