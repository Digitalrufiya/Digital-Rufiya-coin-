<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bitcoin Pound Quiz</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      color: #333;
      padding: 20px;
      text-align: center;
    }
    .card {
      background: white;
      padding: 20px;
      margin: 10px auto;
      max-width: 400px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    button {
      padding: 10px 20px;
      margin-top: 10px;
      background: #0077cc;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #005fa3;
    }
    #donation-msg {
      color: green;
      margin-top: 10px;
    }
    ul {
      padding: 0;
      list-style: none;
    }
    li {
      background: #efefef;
      margin: 5px;
      padding: 8px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h1>ðŸª™ Bitcoin Pound Quiz</h1>
  <div class="card" id="quiz-card">
    <h3 id="question">Loading question...</h3>
    <div id="answers"></div>
  </div>

  <div class="card">
    <p><strong>Your Bitcoin Pound coin ðŸª™: <span id="points">0</span></strong></p>
    <button onclick="donatePoints()">Donate Points to Charity Wallet</button>
    <div id="donation-msg"></div>
  </div>

  <div class="card">
    <h3>ðŸŒŸ Leaderboard</h3>
    <ul id="leaderboard-list"><li>Loading...</li></ul>
  </div>

  <script>
    let questions = [
      { q: "What does BTC stand for?", a: ["Bitcoin", "Bitcash", "Block Trade Coin"], c: 0 },
      { q: "Which country first adopted Bitcoin as legal tender?", a: ["El Salvador", "USA", "Japan"], c: 0 },
      { q: "Who is the creator of Bitcoin?", a: ["Satoshi Nakamoto", "Vitalik Buterin", "Charles Hoskinson"], c: 0 },
      { q: "What is the max supply of Bitcoin?", a: ["21 million", "100 million", "1 billion"], c: 0 },
      { q: "What is a blockchain?", a: ["Distributed ledger", "File system", "Game engine"], c: 0 }
    ];

    let current = 0;
    let points = 0;
    let leaderboard = [];

    function showQuestion() {
      if (current >= questions.length) {
        document.getElementById("quiz-card").innerHTML = `<h3>ðŸŽ‰ Quiz completed!</h3><p>Total Coins: ${points}</p>`;
        return;
      }

      const q = questions[current];
      document.getElementById("question").innerText = q.q;

      const answersDiv = document.getElementById("answers");
      answersDiv.innerHTML = "";

      q.a.forEach((option, i) => {
        const btn = document.createElement("button");
        btn.textContent = option;
        btn.onclick = () => checkAnswer(i);
        answersDiv.appendChild(btn);
      });
    }

    function checkAnswer(selected) {
      if (selected === questions[current].c) {
        points += 2;
        document.getElementById("points").innerText = points;
      }
      current++;
      showQuestion();
    }

    async function donatePoints() {
      if (points === 0) {
        document.getElementById('donation-msg').innerText = "You have no points to donate.";
        return;
      }

      const name = prompt("Enter your name or wallet address:");
      if (!name) return;

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbx-oH3Xu7FiUQ-_ku8Hu_eHlMfcESlIJwgNXVWlc6HkfG70Cgi_uZH6-bs3rgq-f892/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, points })
        });

        const result = await response.json();

        if (result.success === false) {
          document.getElementById('donation-msg').innerText = result.message || "Already donated today.";
        } else {
          document.getElementById('donation-msg').innerText = `Thank you, ${name}! Your points were donated. ðŸŒŸ`;
          points = 0;
          document.getElementById('points').innerText = points;
          fetchLeaderboard();
        }

      } catch (err) {
        console.error(err);
        document.getElementById('donation-msg').innerText = "Error sending data. Try again later.";
      }
    }

    async function fetchLeaderboard() {
      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbx-oH3Xu7FiUQ-_ku8Hu_eHlMfcESlIJwgNXVWlc6HkfG70Cgi_uZH6-bs3rgq-f892/exec?action=getLeaderboard");
        const data = await res.json();
        leaderboard = data.sort((a, b) => b.points - a.points);
        updateLeaderboard();
      } catch (err) {
        console.error("Failed to load leaderboard", err);
        document.getElementById('leaderboard-list').innerHTML = "<li>Failed to load leaderboard</li>";
      }
    }

    function updateLeaderboard() {
      const ul = document.getElementById('leaderboard-list');
      ul.innerHTML = "";
      leaderboard.forEach(entry => {
        const li = document.createElement("li");
        li.innerText = `${entry.name}: ${entry.points} ðŸª™`;
        ul.appendChild(li);
      });
    }

    showQuestion();
    fetchLeaderboard();
  </script>
</body>
</html>
