<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DRFMedia - Profile</title>
</head>
<body>
  <h2>User Profile</h2>
  <form id="profileForm">
    <input type="text" id="name" placeholder="Full Name"><br>
    <input type="text" id="photoURL" placeholder="Profile Photo URL"><br>
    <input type="text" id="wallet" placeholder="Wallet Address"><br>
    <input type="text" id="country" placeholder="Country"><br>
    <select id="gender">
      <option value="">Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Other">Other</option>
    </select><br>
    <input type="number" id="age" placeholder="Age"><br>
    <button type="submit">Save Profile</button>
  </form>

  <p id="status"></p>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB-W_j74lsbmJUFnTbJpn79HM62VLmkQC8",
      authDomain: "drfsocial-23a06.firebaseapp.com",
      databaseURL: "https://drfsocial-23a06-default-rtdb.firebaseio.com",
      projectId: "drfsocial-23a06",
      storageBucket: "drfsocial-23a06.appspot.com",
      messagingSenderId: "608135115201",
      appId: "1:608135115201:web:dc999df2c0f37241ff3f40",
      measurementId: "G-W6VHMP77YR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const name = document.getElementById("name");
    const photoURL = document.getElementById("photoURL");
    const wallet = document.getElementById("wallet");
    const country = document.getElementById("country");
    const gender = document.getElementById("gender");
    const age = document.getElementById("age");
    const status = document.getElementById("status");

    let currentUser = null;

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        const docRef = doc(db, "users", user.uid);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const data = docSnap.data();
          name.value = data.name || "";
          photoURL.value = data.photoURL || "";
          wallet.value = data.wallet || "";
          country.value = data.country || "";
          gender.value = data.gender || "";
          age.value = data.age || "";
          status.textContent = "Profile loaded.";
        } else {
          status.textContent = "Profile not found. Please fill it.";
        }
      } else {
        status.textContent = "You are not logged in.";
      }
    });

    document.getElementById("profileForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!currentUser) {
        alert("Login first to save your profile.");
        return;
      }

      const userData = {
        name: name.value,
        photoURL: photoURL.value,
        wallet: wallet.value,
        country: country.value,
        gender: gender.value,
        age: parseInt(age.value)
      };

      try {
        await setDoc(doc(db, "users", currentUser.uid), userData, { merge: true });
        status.textContent = "✅ Profile saved to server.";
      } catch (err) {
        console.error(err);
        status.textContent = "❌ Error saving profile.";
      }
    });
  </script>
</body>
</html>
