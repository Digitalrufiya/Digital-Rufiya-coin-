<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DRF Wallet - Profile</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="icon" href="favicon.png" type="image/png"/>
</head>
<body class="bg-gray-100 text-gray-900 font-sans">
  <div class="max-w-4xl mx-auto p-4">
    <div class="relative">
      <!-- Cover Photo -->
      <img id="coverPicPreview" class="w-full h-48 object-cover rounded-lg" 
           src="https://i.imgur.com/JgY9Q6Wl.jpg" alt="Cover Photo"/>

      <!-- Avatar -->
      <div class="absolute left-4 -bottom-12 w-24 h-24">
        <img id="profilePicPreview" class="w-24 h-24 object-cover rounded-full border-4 border-white" 
             src="https://i.imgur.com/5tj6S7Ol.png" alt="Profile Picture"/>
      </div>
    </div>

    <div class="mt-16 bg-white p-6 rounded-lg shadow">
      <h2 class="text-2xl font-semibold mb-4">Your Profile</h2>

      <form id="profileForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium">Display Name</label>
          <input type="text" id="displayName" class="mt-1 w-full px-3 py-2 border rounded" required/>
        </div>

        <div>
          <label class="block text-sm font-medium">Bio</label>
          <textarea id="bio" class="mt-1 w-full px-3 py-2 border rounded" rows="3"></textarea>
        </div>

        <div>
          <label class="block text-sm font-medium">Upload Profile Picture</label>
          <input type="file" id="profilePicInput" accept="image/*"/>
        </div>

        <div>
          <label class="block text-sm font-medium">Upload Cover Photo</label>
          <input type="file" id="coverPicInput" accept="image/*"/>
        </div>

        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          Save Profile
        </button>
      </form>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      set,
      get,
      child
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCXIgqV6lz-hpyk8kPB_yrOpWamkm7aV-o",
      authDomain: "digitalrufiya.firebaseapp.com",
      databaseURL: "https://digitalrufiya-default-rtdb.firebaseio.com",
      projectId: "digitalrufiya",
      storageBucket: "digitalrufiya.appspot.com",
      messagingSenderId: "498276655892",
      appId: "1:498276655892:web:6ac62b90c8fa79df85eb7a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const userId = localStorage.getItem("userId") || "91000";
    const nameInput = document.getElementById("displayName");
    const bioInput = document.getElementById("bio");
    const profilePicInput = document.getElementById("profilePicInput");
    const coverPicInput = document.getElementById("coverPicInput");
    const profilePicPreview = document.getElementById("profilePicPreview");
    const coverPicPreview = document.getElementById("coverPicPreview");

    window.onload = () => {
      const userRef = ref(db, `users/${userId}`);
      get(userRef)
        .then((snapshot) => {
          if (snapshot.exists()) {
            const data = snapshot.val();
            nameInput.value = data.name || "";
            bioInput.value = data.bio || "";
            profilePicPreview.src = data.profilePic || profilePicPreview.src;
            coverPicPreview.src = data.coverPic || coverPicPreview.src;
          }
        })
        .catch((error) => {
          console.error("Failed to load user data:", error);
        });
    };

    profilePicInput.addEventListener("change", () => {
      const file = profilePicInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          profilePicPreview.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    coverPicInput.addEventListener("change", () => {
      const file = coverPicInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          coverPicPreview.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    document.getElementById("profileForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const name = nameInput.value.trim();
      const bio = bioInput.value.trim();
      const profilePic = profilePicPreview.src;
      const coverPic = coverPicPreview.src;

      set(ref(db, `users/${userId}`), {
        name,
        bio,
        profilePic,
        coverPic
      })
        .then(() => {
          alert("Profile saved!");
        })
        .catch((error) => {
          console.error("Error saving profile:", error);
          alert("Failed to save profile.");
        });
    });
  </script>
</body>
</html>
