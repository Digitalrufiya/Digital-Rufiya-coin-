<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DRF Profile</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f0f2f5;
    }
    .profile-header {
      position: relative;
      text-align: center;
      color: white;
    }
    .cover-photo {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .profile-pic {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid white;
      position: absolute;
      bottom: -60px;
      left: 50%;
      transform: translateX(-50%);
    }
    .profile-content {
      padding-top: 80px;
      text-align: center;
    }
    .btn {
      margin-top: 10px;
      padding: 8px 16px;
      background: #1877f2;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    input[type="file"] {
      display: none;
    }
  </style>
</head>
<body>
  <div class="profile-header">
    <img id="coverPhoto" class="cover-photo" src="default_cover.jpg" alt="Cover Photo"/>
    <img id="profilePic" class="profile-pic" src="default_profile.jpg" alt="Profile Picture"/>
  </div>

  <div class="profile-content">
    <h2 id="username">Username</h2>
    <p id="bio">User bio goes here...</p>
    <button class="btn" onclick="document.getElementById('editModal').style.display='block'">Edit Profile</button>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" style="display:none; padding:20px; background:white; position:fixed; top:10%; left:10%; width:80%; max-width:400px; box-shadow:0 0 10px #333;">
    <h3>Edit Profile</h3>
    <input type="text" id="editName" placeholder="Username"/><br><br>
    <textarea id="editBio" placeholder="Your bio..."></textarea><br><br>
    <label class="btn">
      Upload Profile Photo
      <input type="file" id="profileUpload"/>
    </label><br><br>
    <label class="btn">
      Upload Cover Photo
      <input type="file" id="coverUpload"/>
    </label><br><br>
    <button class="btn" onclick="saveProfile()">Save</button>
    <button class="btn" onclick="document.getElementById('editModal').style.display='none'" style="background:#ccc;">Cancel</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB-W_j74lsbmJUFnTbJpn79HM62VLmkQC8",
      authDomain: "drfsocial-23a06.firebaseapp.com",
      databaseURL: "https://drfsocial-23a06-default-rtdb.firebaseio.com",
      projectId: "drfsocial-23a06",
      storageBucket: "drfsocial-23a06.appspot.com",
      messagingSenderId: "608135115201",
      appId: "1:608135115201:web:b37dffeb550941ffff3f40",
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const storage = getStorage();

    const userId = "testuser"; // Temporary static user ID

    // Load existing profile
    const userRef = ref(db, 'users/' + userId);
    get(userRef).then((snapshot) => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        document.getElementById('username').textContent = data.name || "No Name";
        document.getElementById('bio').textContent = data.bio || "";
        if (data.profileURL) document.getElementById('profilePic').src = data.profileURL;
        if (data.coverURL) document.getElementById('coverPhoto').src = data.coverURL;
      }
    });

    // Save profile
    async function saveProfile() {
      const name = document.getElementById('editName').value;
      const bio = document.getElementById('editBio').value;

      let profileURL = null;
      let coverURL = null;

      const profileFile = document.getElementById('profileUpload').files[0];
      const coverFile = document.getElementById('coverUpload').files[0];

      if (profileFile) {
        const profilePath = sRef(storage, `profile_pictures/${userId}.jpg`);
        await uploadBytes(profilePath, profileFile);
        profileURL = await getDownloadURL(profilePath);
      }

      if (coverFile) {
        const coverPath = sRef(storage, `cover_photos/${userId}.jpg`);
        await uploadBytes(coverPath, coverFile);
        coverURL = await getDownloadURL(coverPath);
      }

      const userData = {
        name,
        bio,
        ...(profileURL && { profileURL }),
        ...(coverURL && { coverURL }),
      };

      await set(userRef, userData);
      alert("âœ… Profile updated!");
      location.reload();
    }
  </script>
</body>
</html>
