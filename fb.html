import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

const db = getDatabase();
const postsRef = ref(db, 'posts');

onValue(postsRef, (snapshot) => {
  const posts = snapshot.val();
  const now = Date.now();

  for (const postId in posts) {
    const post = posts[postId];
    const postAge = now - post.timestamp;

    if (postAge > 7 * 24 * 60 * 60 * 1000) {
      // Delete post data
      remove(ref(db, `posts/${postId}`));
      // Delete post media (if any)
      deleteStorageFile(post.mediaPath); // Optional
    }
  }
});

// Optional: Delete file from Firebase Storage
import { getStorage, ref as storageRef, deleteObject } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-storage.js";

function deleteStorageFile(path) {
  const storage = getStorage();
  const fileRef = storageRef(storage, path);
  deleteObject(fileRef)
    .then(() => console.log("Deleted old media:", path))
    .catch((err) => console.warn("Delete failed:", err));
}
