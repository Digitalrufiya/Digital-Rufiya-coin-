<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Timeline</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    .post { background: white; border-radius: 10px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .post img, .post video { max-width: 100%; border-radius: 10px; }
    button { margin-top: 10px; padding: 10px 20px; background: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #45a049; }
  </style>
</head>
<body>
  <h2>üì∏ DRF Timeline</h2>
  <div id="timeline"></div>

  <script>
    const timelineData = [
      {
        cid: "QmSeWPJehjHMWYHCmoK6m1B9uLFqFJeHUMHhd2KC6mWm9s",
        description: "My DRF profile pic",
        date: "2025-06-02"
      },
      {
        cid: "QmbWqxBEKC3P8tqsKc98xmWNzr1DcGgydgZYud1KixFELZ",
        description: "Vacation video!",
        date: "2025-06-01"
      }
    ];

    function loadTimeline() {
      const container = document.getElementById("timeline");
      container.innerHTML = "";

      timelineData.forEach(post => {
        const cid = post.cid;
        const mediaURL = `https://ipfs.io/ipfs/${cid}`;
        const isVideo = cid.toLowerCase().endsWith(".mp4") || post.description.toLowerCase().includes("video");

        const postElement = document.createElement("div");
        postElement.className = "post";
        postElement.innerHTML = `
          ${isVideo ?
            `<video controls src="${mediaURL}"></video>` :
            `<img src="${mediaURL}" alt="IPFS media" />`}
          <div class="description">üìù ${post.description}</div>
          <div class="date">üìÖ ${post.date}</div>
          <button onclick="saveToDrive('${mediaURL}')">üì• Save to Drive</button>
        `;
        container.appendChild(postElement);
      });
    }

    async function saveToDrive(fileUrl) {
      alert("Saving to Drive...");

      const response = await fetch(fileUrl);
      const blob = await response.blob();

      const formData = new FormData();
      formData.append("file", blob, "media-" + Date.now());

      const scriptURL = "YOUR_APPS_SCRIPT_URL_HERE"; // üëà Replace this with your Google Script URL

      try {
        const res = await fetch(scriptURL, {
          method: "POST",
          body: formData,
        });

        const text = await res.text();
        alert("‚úÖ Saved: " + text);
      } catch (err) {
        console.error(err);
        alert("‚ùå Upload failed.");
      }
    }

    loadTimeline();
  </script>
</body>
</html>
