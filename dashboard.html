<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DRF Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body style="font-family:sans-serif;background:#f0fcf9; text-align:center; padding:20px;">

  <h1>DRF Wallet Dashboard</h1>
  <p id="walletAddress" style="font-weight:bold;"></p>

  <div style="margin-top: 30px;">
    <p>BNB Balance: <span id="bnbBalance">Loading...</span></p>
    <p>DRF Balance: <span id="drfBalance">Loading...</span></p>
    <p>USDC Balance: <span id="usdcBalance">Loading...</span></p>
    <p>USDT Balance: <span id="usdtBalance">Loading...</span></p>
  </div>

  <script>
    const provider = new ethers.providers.JsonRpcProvider("https://bsc-dataseed.binance.org/");
    
    const DRF_TOKEN = {
      address: "0xYourDRFContractAddress",
      decimals: 18
    };
    const USDC_TOKEN = {
      address: "0x8ac76a51cc950d9822d68b83fe1ad97b32cd580d",
      decimals: 18
    };
    const USDT_TOKEN = {
      address: "0x55d398326f99059fF775485246999027B3197955",
      decimals: 18
    };

    async function loadWalletAndBalances() {
      const encryptedJson = localStorage.getItem("drf_encrypted_wallet");
      if (!encryptedJson) return alert("Wallet not found. Please login.");

      const password = prompt("Enter your password to unlock wallet:");
      if (!password) return;

      try {
        const wallet = await ethers.Wallet.fromEncryptedJson(encryptedJson, password);
        const connectedWallet = wallet.connect(provider);

        // Display wallet address
        document.getElementById("walletAddress").textContent = "Wallet: " + wallet.address;

        // Load native BNB balance
        const bnb = await provider.getBalance(wallet.address);
        document.getElementById("bnbBalance").textContent = ethers.utils.formatEther(bnb) + " BNB";

        // Load token balances
        await loadTokenBalance(DRF_TOKEN, "drfBalance", connectedWallet);
        await loadTokenBalance(USDC_TOKEN, "usdcBalance", connectedWallet);
        await loadTokenBalance(USDT_TOKEN, "usdtBalance", connectedWallet);

      } catch (err) {
        alert("Failed to decrypt wallet. Incorrect password or corrupted wallet.");
        console.error(err);
      }
    }

    async function loadTokenBalance(token, elementId, wallet) {
      const abi = ["function balanceOf(address) view returns (uint256)"];
      const contract = new ethers.Contract(token.address, abi, wallet);
      const balance = await contract.balanceOf(wallet.address);
      const formatted = ethers.utils.formatUnits(balance, token.decimals);
      document.getElementById(elementId).textContent = formatted;
    }

    window.onload = loadWalletAndBalances;
  </script>
</body>
</html>
