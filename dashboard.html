<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DRF Wallet Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body style="font-family: Arial; background: #f4f9fb; padding: 20px;">

  <div style="display:flex; justify-content: space-between; align-items: center;">
    <h2>My Assets</h2>
    <a href="settings.html" style="text-decoration:none; font-size:14px;">Settings ⚙️</a>
  </div>

  <p id="walletAddress" style="font-weight: bold;"></p>

  <div style="margin-top:20px;">
    <div><strong>BNB:</strong> <span id="bnbBalance">Loading...</span></div>
    <div><strong>DRF:</strong> <span id="drfBalance">Loading...</span></div>
    <div><strong>USDC:</strong> <span id="usdcBalance">Loading...</span></div>
    <div><strong>USDT:</strong> <span id="usdtBalance">Loading...</span></div>
  </div>

  <h3 style="margin-top: 30px;">Receive Tokens</h3>
  <div id="receiveSection"></div>

  <script>
    const tokenList = [
      {
        name: "DRF",
        address: "0x7788a60dbC85AB46767F413EC7d51F149AA1bec6",
        decimals: 18,
        elementId: "drfBalance"
      },
      {
        name: "USDC",
        address: "0x8ac76a51cc950d9822d68b83fe1ad97b32cd580d",
        decimals: 18,
        elementId: "usdcBalance"
      },
      {
        name: "USDT",
        address: "0x55d398326f99059fF775485246999027B3197955",
        decimals: 18,
        elementId: "usdtBalance"
      }
    ];

    async function loadDashboard() {
      const encrypted = localStorage.getItem("drf_encrypted_wallet");
      if (!encrypted) return location.href = "index.html";

      const password = prompt("Enter your password to unlock wallet:");
      try {
        const wallet = await ethers.Wallet.fromEncryptedJson(encrypted, password);
        const provider = new ethers.providers.JsonRpcProvider("https://bsc-dataseed.binance.org/");
        const connectedWallet = wallet.connect(provider);

        document.getElementById("walletAddress").innerText = "Address: " + wallet.address;

        // Show BNB
        const bnb = await provider.getBalance(wallet.address);
        document.getElementById("bnbBalance").innerText = ethers.utils.formatEther(bnb) + " BNB";

        // Show token balances
        for (let token of tokenList) {
          const contract = new ethers.Contract(token.address, [
            "function balanceOf(address) view returns (uint)",
            "function decimals() view returns (uint8)"
          ], provider);
          const raw = await contract.balanceOf(wallet.address);
          const value = ethers.utils.formatUnits(raw, token.decimals);
          document.getElementById(token.elementId).innerText = parseFloat(value).toFixed(4) + " " + token.name;
        }

        showReceiveSection(wallet.address);

      } catch (err) {
        alert("Failed to unlock wallet. Redirecting...");
        location.href = "index.html";
      }
    }

    function showReceiveSection(address) {
      const section = document.getElementById("receiveSection");
      const tokens = ["BNB", "DRF", "USDC", "USDT"];
      tokens.forEach(token => {
        const div = document.createElement("div");
        div.style.margin = "10px 0";
        div.innerHTML = `
          <strong>${token} Wallet:</strong><br>
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${address}" alt="${token} QR"><br>
          <input type="text" value="${address}" style="width: 80%;" readonly onclick="this.select()" />
          <a href="https://bscscan.com/address/${address}" target="_blank">View on BscScan</a>
          <hr/>
        `;
        section.appendChild(div);
      });
    }

    loadDashboard();
  </script>
</body>
</html>


  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <a href="dashboard.html" class="tab-item"><img src="icons/dashboard.svg" alt="Dashboard">Dashboard</a>
    <a href="send.html" class="tab-item"><img src="icons/send.svg" alt="Send">Send</a>
    <a href="swap.html" class="tab-item"><img src="icons/swap.svg" alt="Swap">Swap</a>
    <a href="transactions.html" class="tab-item"><img src="icons/tx.svg" alt="Tx">Transactions</a>
    <a href="tokensale.html" class="tab-item"><img src="icons/token.svg" alt="Token">Token Sale</a>
  </div>
