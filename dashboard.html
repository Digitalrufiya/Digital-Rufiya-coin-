
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DRF Wallet - Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
</head>
<body style="font-family: Arial, sans-serif; background: #f7fcff; text-align: center; padding-bottom: 120px;">

  <div style="position: absolute; top: 10px; right: 10px;">
    <a href="index.html" style="text-decoration: none; font-size: 14px; padding: 8px 14px; background: #007bff; color: white; border-radius: 5px;">Home</a>
  </div>

  <h2 style="margin-top: 20px;">Dashboard</h2>
  <p id="walletAddress" style="font-weight: bold; color: #333;">Checking wallet...</p>
  <button id="connectFallback" onclick="connectWallet()" style="display:none; margin-top:10px;">Connect Wallet</button>

  <div style="margin: 20px auto; width: 90%; max-width: 400px;">
    <h3>Token Balances</h3>
    <p>DRF: <span id="drfBalance">Loading...</span></p>
    <p>USDC: <span id="usdcBalance">Loading...</span></p>
    <p>USDT: <span id="usdtBalance">Loading...</span></p>
  </div>

  <div>
    <h3>Receive</h3>
    <select id="tokenSelect" onchange="updateReceiveQR()">
      <option value="DRF">DRF</option>
      <option value="USDC">USDC</option>
      <option value="USDT">USDT</option>
    </select>
    <div id="qrcode" style="margin: 20px auto;"></div>
    <input type="text" id="walletDisplay" readonly style="width: 90%; max-width: 400px; padding: 10px; margin: 10px auto; display: block;" />
    <button onclick="copyAddress()">Copy Address</button>
  </div>

  <footer style="margin-top: 40px; font-size: 13px; color: #666;">
    <hr style="margin: 20px auto; width: 80%;" />
    <p>Â© 2025 DRF Wallet | Powered by BSC Blockchain Network + AI Technology</p>
  </footer>

  <div class="bottom-nav" style="position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #ccc;">
    <a href="dashboard.html"><img src="icon/dashboard.png" alt="Dashboard" width="24" /><br>Dashboard</a>
    <a href="send.html"><img src="icon/send.png" alt="Send" width="24" /><br>Send</a>
    <a href="swap.html"><img src="icon/swap.png" alt="Swap" width="24" /><br>Swap</a>
    <a href="transactions.html"><img src="icon/transactions.png" alt="Transactions" width="24" /><br>Transactions</a>
    <a href="tokensale.html"><img src="icon/token.png" alt="Token" width="24" /><br>Token</a>
  </div>

  <script>
    async function loadDashboard() {
      if (window.ethereum && window.ethereum.selectedAddress) {
        const address = window.ethereum.selectedAddress;
        document.getElementById("walletAddress").innerText = "Connected: " + address.slice(0, 6) + "..." + address.slice(-4);
        document.getElementById("walletDisplay").value = address;
        document.getElementById("connectFallback").style.display = "none";
        updateReceiveQR();
        fetchBalances(address);
      } else {
        document.getElementById("walletAddress").innerText = "Wallet not connected.";
        document.getElementById("connectFallback").style.display = "inline-block";
      }
    }

    async function connectWallet() {
      if (window.ethereum) {
        try {
          const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
          if (accounts.length > 0) {
            location.reload();
          }
        } catch (err) {
          alert("Connection rejected.");
        }
      } else {
        alert("MetaMask not found.");
      }
    }

    function copyAddress() {
      const copyText = document.getElementById("walletDisplay");
      copyText.select();
      copyText.setSelectionRange(0, 99999);
      document.execCommand("copy");
      alert("Copied address: " + copyText.value);
    }

    function updateReceiveQR() {
      const address = document.getElementById("walletDisplay").value;
      const token = document.getElementById("tokenSelect").value;
      QRCode.toCanvas(document.getElementById("qrcode"), `${token}:${address}`);
    }

    async function fetchBalances(address) {
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const tokens = {
        DRF: '0x7788a60dbC85AB46767F413EC7d51F149AA1bec6',
        USDC: '0x8ac76a51cc950d9822d68b83fe1ad97b32cd580d',
        USDT: '0x55d398326f99059fF775485246999027B3197955'
      };
      const abi = ["function balanceOf(address) view returns (uint256)", "function decimals() view returns (uint8)"];
      for (const key in tokens) {
        const contract = new ethers.Contract(tokens[key], abi, provider);
        const balance = await contract.balanceOf(address);
        const decimals = await contract.decimals();
        const formatted = ethers.utils.formatUnits(balance, decimals);
        document.getElementById(`${key.toLowerCase()}Balance`).innerText = formatted.slice(0, 8);
      }
    }

    window.addEventListener("DOMContentLoaded", loadDashboard);
  </script>
</body>
</html>
