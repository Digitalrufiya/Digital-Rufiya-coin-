<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DRF Wallet Dashboard</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body style="font-family: Arial; background: #f4f9fb; padding: 20px;">

  <header style="display: flex; justify-content: space-between; align-items: center; position: relative;">
    <h2 style="font-size: 24px; font-weight: bold;">My Assets</h2>
    <div style="font-size: 14px; color: #007bff; text-align: center; animation: rotation 5s linear infinite;">Digital Rufiya Wallet - Financial Revolution Powered by BSC Blockchain Network</div>
    <a href="settings.html" style="font-size: 14px; text-decoration: none;">‚öôÔ∏è Settings</a>
  </header>

  <div>
    <h3>Total Portfolio Value: <span id="totalValue">0.00</span> USD</h3>
    <p id="walletAddress" style="font-weight: bold;"></p>
  </div>

  <!-- Wallet Recovery Section -->
  <div style="max-width: 400px; margin: auto; padding: 20px; background: #fff; border-radius: 10px;">
    <h3>Wallet Recovery / Regeneration</h3>
    <button onclick="recoverWallet()" style="padding: 10px 20px; background-color: #007bff; color: white;">Recover Wallet</button>
    <button onclick="regenerateWallet()" style="padding: 10px 20px; background-color: #28a745; color: white;">Regenerate New Wallet</button>
    <div id="mnemonicOutput" style="margin-top: 15px; display: none;">
      <h4>Your Secret Phrase (Mnemonic):</h4>
      <p id="mnemonicPhrase"></p>
      <button onclick="copyMnemonic()">üìã Copy</button>
    </div>
  </div>

  <!-- Request Deposit Section -->
  <h3 style="margin-top: 30px;">Request Deposit</h3>
  <div style="max-width: 400px; background: #fff; padding: 20px; border-radius: 10px;">
    <label for="tokenSelect">Choose Token:</label>
    <select id="tokenSelect" style="width: 100%; padding: 8px; margin-bottom: 10px;">
      <option value="DRF">DRF</option>
      <option value="USDC">USDC</option>
      <option value="USDT">USDT</option>
    </select>

    <label for="amountInput">Enter Amount:</label>
    <input type="number" id="amountInput" placeholder="e.g. 50" style="width: 100%; padding: 8px; margin-bottom: 10px;" />

    <button onclick="generateDepositLink()" style="padding: 10px 20px; background-color: #007bff; color: white;">Generate Deposit Link</button>

    <div id="depositOutput" style="margin-top: 15px; display: none;">
      <p><strong>Link:</strong> <span id="depositLink"></span></p>
      <button onclick="copyDepositLink()">üìã Copy</button>
      <div id="qrCode" style="margin-top: 10px;"></div>
    </div>
  </div>

  <!-- Sell DRF -->
  <div style="margin-top: 30px;">
    <button onclick="sellDRF()" style="padding: 10px 20px; background-color: #007bff; color: white;">Sell DRF to Mainnet</button>
  </div>

  <!-- FOOTER -->
  <div class="bottom-nav" style="position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #ccc;">
    <a href="dashboard.html"><img src="icon/dashboard.png" alt="Dashboard" width="24" /><br>Dashboard</a>
    <a href="send.html"><img src="icon/send.png" alt="Send" width="24" /><br>Send</a>
    <a href="swap.html"><img src="icon/swap.png" alt="Swap" width="24" /><br>Swap</a>
    <a href="transactions.html"><img src="icon/transactions.png" alt="Transactions" width="24" /><br>Transactions</a>
    <a href="tokensale.html"><img src="icon/token.png" alt="Token" width="24" /><br>Token</a>
  </div>

  <!-- Footer text -->
  <footer style="text-align: center; margin-top: 30px;">
    <p>2025 ¬© DRF Wallet powered by AI technology and ChatGPT</p>
  </footer>

<script>
  const BSC_RPC = "https://bsc-dataseed.binance.org/";
  const provider = new ethers.providers.JsonRpcProvider(BSC_RPC);

  let currentWallet = null;  // Store the current wallet instance

  // Function to recover the wallet
  async function recoverWallet() {
    const mnemonic = prompt("Enter your secret phrase (Mnemonic) to recover your wallet:");
    if (!mnemonic) {
      alert("Please enter a valid secret phrase.");
      return;
    }
    
    try {
      currentWallet = ethers.Wallet.fromMnemonic(mnemonic);
      displayWalletInfo(currentWallet);
    } catch (e) {
      alert("Invalid secret phrase.");
    }
  }

  // Function to regenerate a new wallet
  async function regenerateWallet() {
    currentWallet = ethers.Wallet.createRandom();
    const mnemonic = currentWallet.mnemonic.phrase;
    document.getElementById("mnemonicPhrase").innerText = mnemonic;
    document.getElementById("mnemonicOutput").style.display = "block";
    alert("A new wallet has been generated. Make sure to save your secret phrase.");
  }

  // Display wallet info after recovery or generation
  function displayWalletInfo(wallet) {
    document.getElementById("walletAddress").innerText = "Wallet: " + wallet.address;
    loadDashboard(wallet);
  }

  // Function to copy the mnemonic to clipboard
  function copyMnemonic() {
    const mnemonic = document.getElementById("mnemonicPhrase").innerText;
    navigator.clipboard.writeText(mnemonic).then(() => {
      alert("Mnemonic copied to clipboard!");
    });
  }

  // Existing loadDashboard function with wallet passed as argument
  async function loadDashboard(wallet) {
    const addr = wallet.address;
    let totalValue = 0;
    for (let token in tokens) {
      const contract = new ethers.Contract(tokens[token].address, ["function balanceOf(address) view returns(uint)"], provider);
      const balance = await contract.balanceOf(addr);
      const formattedBalance = ethers.utils.formatUnits(balance, tokens[token].decimals);
      document.getElementById(`${token.toLowerCase()}Balance`).innerText = formattedBalance;

      const price = await getPrice(tokens[token].symbol);
      document.getElementById(`${token.toLowerCase()}Price`).innerText = price ? "$" + price.toFixed(4) : "‚Äî";
      totalValue += parseFloat(formattedBalance) * (price || 0);
    }
    document.getElementById("totalValue").innerText = totalValue.toFixed(2);
    showReceiveSection(addr);
  }

  // Existing getPrice, showReceiveSection, and other functions
</script>

</body>
</html>
