<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DRF Google Firebase Auth Test</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
  #user-info { margin-top: 20px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 1px 5px rgba(0,0,0,0.1); }
  button { padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; border: none; background-color: #4285F4; color: white; }
  #log { margin-top: 15px; white-space: pre-wrap; background: #eee; padding: 10px; border-radius: 5px; height: 120px; overflow-y: auto; }
</style>
</head>
<body>

<h1>DRF Firebase Google Auth Demo</h1>
<button id="googleSignInBtn">Sign In with Google</button>
<button id="signOutBtn" style="display:none; margin-left:10px; background:#db4437;">Sign Out</button>

<div id="user-info"></div>
<div id="log"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB-W_j74lsbmJUFnTbJpn79HM62VLmkQC8",
    authDomain: "drfsocial-23a06.firebaseapp.com",
    projectId: "drfsocial-23a06",
    storageBucket: "drfsocial-23a06.appspot.com",
    messagingSenderId: "608135115201",
    appId: "1:608135115201:web:dc999df2c0f37241ff3f40"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const logDiv = document.getElementById('log');
  function logToPage(msg) {
    logDiv.textContent += msg + '\n';
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  const userInfoDiv = document.getElementById('user-info');
  const signInBtn = document.getElementById('googleSignInBtn');
  const signOutBtn = document.getElementById('signOutBtn');

  signInBtn.onclick = async () => {
    logToPage("Attempting Google Sign-In...");
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;
      logToPage("Signed in successfully!");
      showUserInfo(user);
    } catch (error) {
      logToPage("Sign-in error: " + error.message);
    }
  };

  signOutBtn.onclick = async () => {
    try {
      await signOut(auth);
      logToPage("Signed out.");
      userInfoDiv.innerHTML = '';
      signOutBtn.style.display = 'none';
      signInBtn.style.display = 'inline-block';
    } catch (error) {
      logToPage("Sign-out error: " + error.message);
    }
  };

  function showUserInfo(user) {
    userInfoDiv.innerHTML = `
      <h3>Welcome, ${user.displayName}!</h3>
      <p><strong>Email:</strong> ${user.email}</p>
      <img src="${user.photoURL}" alt="User Photo" width="80" style="border-radius:50%;" />
    `;
    signInBtn.style.display = 'none';
    signOutBtn.style.display = 'inline-block';
  }

  // Automatically detect auth state changes
  onAuthStateChanged(auth, user => {
    if (user) {
      logToPage("User already signed in.");
      showUserInfo(user);
    } else {
      logToPage("No user signed in.");
      userInfoDiv.innerHTML = '';
      signOutBtn.style.display = 'none';
      signInBtn.style.display = 'inline-block';
    }
  });
</script>

</body>
</html>
