<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>DRFTube â€“ Watch Videos</title>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #0a84ff;
    }
    .video-item {
      background: #222;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 30px;
      box-shadow: 0 0 10px #0a84ff88;
    }
    .video-item h3 {
      margin: 0 0 10px 0;
      color: #0affff;
    }
    .video-item p {
      margin: 0 0 12px 0;
      font-size: 0.9rem;
      color: #ccc;
    }
    video {
      width: 100%;
      max-height: 360px;
      border-radius: 10px;
      background: #000;
    }
    #loading {
      text-align: center;
      margin: 40px 0;
      font-size: 1.2rem;
      color: #0aff6b;
    }
  </style>
</head>
<body>

  <h1>ðŸŽ¬ DRFTube â€” Watch Videos</h1>

  <div id="loading">Loading videos...</div>
  <div id="videosContainer"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCdFX1PbNEgubM4Zib7U-hgtJbSOONPk6U",
      authDomain: "drftube-634c6.firebaseapp.com",
      projectId: "drftube-634c6",
      storageBucket: "drftube-634c6.appspot.com",
      messagingSenderId: "819828633864",
      appId: "1:819828633864:web:513002b461259b000cbcbd",
      measurementId: "G-ZPTJE4DMNN"
    };

    // Initialize Firebase & Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const videosContainer = document.getElementById('videosContainer');
    const loading = document.getElementById('loading');

    // Simple escape for text
    function escapeHtml(text) {
      if (!text) return "";
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    async function loadVideos() {
      try {
        const videosRef = collection(db, "videos");
        const q = query(videosRef, orderBy("uploadedAt", "desc"));
        const snapshot = await getDocs(q);

        loading.style.display = "none";

        if (snapshot.empty) {
          videosContainer.innerHTML = "<p>No videos uploaded yet.</p>";
          return;
        }

        snapshot.forEach(doc => {
          const video = doc.data();
          const ipfsUrl = `https://gateway.pinata.cloud/ipfs/${video.ipfsHash}`;

          const videoDiv = document.createElement("div");
          videoDiv.className = "video-item";

          videoDiv.innerHTML = `
            <h3>${escapeHtml(video.title)}</h3>
            <p>${escapeHtml(video.description || '')}</p>
            <video controls preload="metadata">
              <source src="${ipfsUrl}" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          `;

          videosContainer.appendChild(videoDiv);
        });

      } catch (error) {
        loading.textContent = "Failed to load videos: " + error.message;
      }
    }

    // Load videos on page load
    loadVideos();

  </script>

</body>
</html>
