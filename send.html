<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Send Tokens - DRF Wallet</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: sans-serif;
      background: #f0fcf9;
      margin: 0;
      padding-bottom: 60px; /* space for footer */
    }
    .container {
      max-width: 400px;
      margin: 50px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    input, select, button {
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background-color: #4caf50;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #45a049;
    }
    #status {
      margin-top: 15px;
      min-height: 20px;
      font-weight: 600;
      word-break: break-word;
    }
    #confirmModal {
      display: none;
      position: fixed; 
      top: 0; left: 0; right: 0; bottom: 0; 
      background: rgba(0,0,0,0.6);
      z-index: 1000; 
      align-items: center; 
      justify-content: center;
    }
    #confirmModal > div {
      background: white; 
      padding: 20px; 
      border-radius: 10px; 
      max-width: 320px; 
      margin: auto;
      text-align: center;
    }
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 50px;
      background: #fff;
      border-top: 1px solid #ddd;
      display: flex;
      justify-content: space-around;
      align-items: center;
      box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
    }
    .tab-item {
      text-decoration: none;
      color: #555;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .tab-item img {
      width: 20px;
      margin-bottom: 2px;
    }
    footer {
      position: fixed;
      bottom: 50px;
      left: 0;
      right: 0;
      text-align: center;
      padding: 10px 0;
      background: #222;
      color: #eee;
      font-size: 14px;
      font-weight: 500;
      user-select: none;
      z-index: 999;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Send Tokens</h1>

    <label for="tokenSelect">Select Token</label>
    <select id="tokenSelect" name="tokenSelect">
      <option value="DRF">DRF</option>
      <option value="USDC">USDC</option>
      <option value="USDT">USDT</option>
    </select>

    <input type="text" id="recipient" placeholder="Receiver wallet address" />
    <input type="number" id="amount" placeholder="Amount to send" min="0" step="any" />

    <button onclick="confirmSend()">Send</button>
    <p id="status"></p>
  </div>

  <!-- Confirmation Modal -->
  <div id="confirmModal">
    <div>
      <h3>Confirm Transaction</h3>
      <p id="confirmText"></p>
      <button onclick="executeSend()">Confirm</button>
      <button onclick="closeModal()">Cancel</button>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <a href="dashboard.html" class="tab-item"><img src="icons/dashboard.svg" alt="Dashboard">Dashboard</a>
    <a href="send.html" class="tab-item"><img src="icons/send.svg" alt="Send">Send</a>
    <a href="swap.html" class="tab-item"><img src="icons/swap.svg" alt="Swap">Swap</a>
    <a href="transactions.html" class="tab-item"><img src="icons/tx.svg" alt="Tx">Transactions</a>
    <a href="tokensale.html" class="tab-item"><img src="icons/token.svg" alt="Token">Token Sale</a>
  </div>

  <footer>
    2025 DRF Wallet Powered by BSC blockchain network and AI Tools
  </footer>

  <script>
    const ADMIN_ADDRESS = "0x7788a60dbC85AB46767F413EC7d51F149AA1bec6"; // DRF contract address for fee
    const tokenContracts = {
      DRF: "0x7788a60dbC85AB46767F413EC7d51F149AA1bec6",
      USDC: "0x8ac76a51cc950d9822d68b83fe1ad97b32cd580d",
      USDT: "0x55d398326f99059fF775485246999027B3197955"
    };

    const ABI = [
      "function transfer(address to, uint amount) public returns (bool)",
      "function decimals() public view returns (uint8)"
    ];

    let token, signer, provider, decimals;
    let selectedToken, recipient, amount, feeAmount, sendAmount;

    async function confirmSend() {
      selectedToken = document.getElementById("tokenSelect").value;
      recipient = document.getElementById("recipient").value.trim();
      amount = parseFloat(document.getElementById("amount").value);

      if (!recipient || !amount || amount <= 0) {
        alert("Please enter a valid recipient address and amount.");
        return;
      }

      if (!window.ethereum) {
        alert("MetaMask or another Ethereum wallet is required to send tokens.");
        return;
      }

      try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();

        token = new ethers.Contract(tokenContracts[selectedToken], ABI, signer);
        decimals = await token.decimals();

        const fullAmount = ethers.utils.parseUnits(amount.toString(), decimals);
        feeAmount = fullAmount.mul(5).div(100); // 5% fee
        sendAmount = fullAmount.sub(feeAmount);

        document.getElementById("confirmText").innerText =
          `You are about to send ${ethers.utils.formatUnits(sendAmount, decimals)} ${selectedToken} to:\n${recipient}\n\n` +
          `A 5% fee (${ethers.utils.formatUnits(feeAmount, decimals)} ${selectedToken}) will be sent to the DRF contract address to support liquidity.\n\n` +
          `Please confirm that you own this wallet and are responsible for this transaction. No one else can access or reverse it.`;

        document.getElementById("confirmModal").style.display = "flex";
      } catch (error) {
        alert("Error preparing transaction: " + error.message);
      }
    }

    async function executeSend() {
      try {
        document.getElementById("status").innerText = "Sending transaction...";
        const tx1 = await token.transfer(recipient, sendAmount);
        await tx1.wait();
        const tx2 = await token.transfer(ADMIN_ADDRESS, feeAmount);
        await tx2.wait();

        const bscScanUrl = `https://bscscan.com/tx/${tx1.hash}`;
        document.getElementById("status").innerHTML =
          `Success! Transaction hash: <a href="${bscScanUrl}" target="_blank" rel="noopener">${tx1.hash}</a>`;
        closeModal();
      } catch (e) {
        document.getElementById("status").innerText = "Transaction failed: " + e.message;
        closeModal();
      }
    }

    function closeModal() {
      document.getElementById("confirmModal").style.display = "none";
    }
  </script>
</body>
</html>
