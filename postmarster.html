<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Create a Post</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; }
  label { font-weight: bold; display: block; margin-top: 1rem; }
  input[type="file"], textarea {
    margin-top: 0.3rem; width: 100%; font-size: 1rem;
  }
  textarea { min-height: 100px; padding: 0.5rem; }
  button {
    margin-top: 1.5rem; padding: 0.7rem 1.2rem; font-size: 1rem; cursor: pointer;
  }
  .preview {
    margin-top: 1rem;
    max-height: 300px;
  }
</style>
</head>
<body>

<h1>Create a Post</h1>

<form id="postForm">
  <label for="mediaInput">Upload Photo or Video:</label>
  <input type="file" id="mediaInput" accept="image/*,video/*" required />

  <label for="textInput">Post Text:</label>
  <textarea id="textInput" placeholder="Write something..." required></textarea>

  <button type="submit">Post</button>
</form>

<div id="previewContainer"></div>

<script>
  const user = JSON.parse(localStorage.getItem('drfUser')) || null;

  if (!user) {
    alert('You must be logged in to post!');
    window.location.href = 'profile.html'; // or your login page
  }

  const mediaInput = document.getElementById('mediaInput');
  const previewContainer = document.getElementById('previewContainer');

  mediaInput.addEventListener('change', () => {
    const file = mediaInput.files[0];
    if (!file) {
      previewContainer.innerHTML = '';
      return;
    }
    const reader = new FileReader();
    reader.onload = function(e) {
      if (file.type.startsWith('image/')) {
        previewContainer.innerHTML = `<img src="${e.target.result}" class="preview" alt="preview"/>`;
      } else if (file.type.startsWith('video/')) {
        previewContainer.innerHTML = `<video controls class="preview"><source src="${e.target.result}" type="${file.type}"></video>`;
      } else {
        previewContainer.innerHTML = 'Unsupported media type';
      }
    };
    reader.readAsDataURL(file);
  });

  document.getElementById('postForm').addEventListener('submit', (e) => {
    e.preventDefault();

    const file = mediaInput.files[0];
    const text = document.getElementById('textInput').value.trim();

    if (!file || !text) {
      alert('Please select a media file and enter text');
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      const posts = JSON.parse(localStorage.getItem('drfPosts')) || [];

      const newPost = {
        id: Date.now(),
        userEmail: user.email,
        mediaUrl: e.target.result,
        mediaType: file.type,
        text,
        timestamp: new Date().toISOString()
      };

      posts.unshift(newPost);
      localStorage.setItem('drfPosts', JSON.stringify(posts));

      alert('Post created!');
      window.location.reload(); // reload or redirect to feed/profile page
    };

    reader.readAsDataURL(file);
  });
</script>

</body>
</html>
