<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stake DRF Tokens</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f6f9; }
    input, button { padding: 10px; width: 100%; margin-top: 10px; }
    #responseMsg { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Stake DRF Tokens</h2>
  <form id="stakingForm">
    <input type="text" id="walletAddress" placeholder="DRF Wallet Address" required>
    <input type="number" id="stakeAmount" placeholder="Amount to Stake (USDC)" min="25" required>
    <input type="file" id="fileUpload">
    <button type="submit">Submit Staking</button>
  </form>
  <p id="responseMsg"></p>

  <script>
    document.getElementById('stakingForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const wallet = document.getElementById('walletAddress').value.trim();
      const amount = document.getElementById('stakeAmount').value.trim();
      const fileInput = document.getElementById('fileUpload');
      const file = fileInput.files[0];

      const data = {
        stakingDetails: { walletAddress: wallet, stakeAmount: amount }
      };

      if (file) {
        const reader = new FileReader();
        reader.onload = async function (e) {
          const base64 = e.target.result.split(',')[1];
          data.file = {
            fileName: file.name,
            fileBase64: base64,
            mimeType: file.type
          };
          await sendToScript(data);
        };
        reader.readAsDataURL(file);
      } else {
        await sendToScript(data);
      }
    });

    async function sendToScript(payload) {
      const endpoint = "https://script.google.com/macros/s/AKfycby9XhmGdvUimYCNDeBUC3SO7_WleuoWS03t-CdGllWvkE4Fyje2MzU-RjHYXwQV9cJJ/exec";
      try {
        const response = await fetch(endpoint, {
          method: "POST",
          body: JSON.stringify(payload),
          headers: { "Content-Type": "application/json" }
        });
        const result = await response.text();
        document.getElementById('responseMsg').innerText = "✅ Submitted: " + result;
        document.getElementById('stakingForm').reset();
      } catch (err) {
        document.getElementById('responseMsg').innerText = "❌ Submission failed.";
        console.error(err);
      }
    }
  </script>
</body>
</html>
