<!DOCTYPE html>
<html>
<head>
  <title>DRF Social</title>
</head>
<body>

  <h2>Profile Setup</h2>
  <input type="text" id="username" placeholder="Enter username"><br><br>
  <input type="file" id="profilePhoto"><br><br>
  <button id="saveProfile">Save Profile</button>

  <hr>

  <h2>Create Post</h2>
  <textarea id="postText" placeholder="Write your post..."></textarea><br><br>
  <input type="file" id="postMedia" accept="image/*,video/mp4"><br><br>
  <button id="sendPost">Post</button>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getDatabase, ref, set, push } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB-W_j74lsbmJUFnTbJpn79HM62VLmkQC8",
      authDomain: "drfsocial-23a06.firebaseapp.com",
      databaseURL: "https://drfsocial-23a06-default-rtdb.firebaseio.com",
      projectId: "drfsocial-23a06",
      storageBucket: "drfsocial-23a06.appspot.com",
      messagingSenderId: "608135115201",
      appId: "1:608135115201:web:b37dffeb550941ffff3f40",
      measurementId: "G-TPT7QMWDYE"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);

    // Helper: Upload media file
    async function uploadFile(path, file) {
      const fileRef = sRef(storage, `${path}/${Date.now()}_${file.name}`);
      const snapshot = await uploadBytes(fileRef, file);
      return await getDownloadURL(fileRef);
    }

    // Save Profile
    document.getElementById('saveProfile').addEventListener('click', async () => {
      const username = document.getElementById('username').value.trim();
      const photoFile = document.getElementById('profilePhoto').files[0];

      if (!username) return alert("Enter username");
      let photoURL = null;

      if (photoFile) {
        photoURL = await uploadFile("profilePhotos", photoFile);
      }

      await set(ref(db, 'users/' + username), {
        username: username,
        profilePhoto: photoURL || "",
      });

      alert("Profile saved!");
    });

    // Create Post
    document.getElementById('sendPost').addEventListener('click', async () => {
      const text = document.getElementById('postText').value.trim();
      const mediaFile = document.getElementById('postMedia').files[0];

      if (!text && !mediaFile) return alert("Write something or add media");

      let mediaURL = null;
      let mediaType = null;

      if (mediaFile) {
        mediaURL = await uploadFile("postMedia", mediaFile);
        mediaType = mediaFile.type.startsWith("video") ? "video" : "image";
      }

      await set(push(ref(db, "posts")), {
        text: text || "",
        mediaURL: mediaURL || "",
        mediaType: mediaType || "",
        timestamp: Date.now()
      });

      alert("Post sent!");
      document.getElementById('postText').value = "";
      document.getElementById('postMedia').value = "";
    });
  </script>

</body>
</html>
