<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DRF Social DApp</title>
<style>
  /* Basic styles */
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f0f2f5;
    color: #333;
  }
  header {
    background: #4267B2;
    color: white;
    padding: 1rem;
    text-align: center;
  }
  main {
    max-width: 900px;
    margin: 1rem auto;
    background: white;
    padding: 1rem;
    border-radius: 6px;
  }
  input, textarea, button {
    font-size: 1rem;
    margin: 0.25rem 0;
    padding: 0.5rem;
    width: 100%;
    box-sizing: border-box;
  }
  button {
    background: #4267B2;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  button:disabled {
    background: #a0b4db;
    cursor: not-allowed;
  }
  .post, .comment {
    border: 1px solid #ddd;
    border-radius: 6px;
    margin-bottom: 1rem;
    padding: 1rem;
  }
  .post-header {
    display: flex;
    align-items: center;
    margin-bottom: 0.5rem;
  }
  .post-header img {
    width: 40px; height: 40px;
    border-radius: 50%;
    margin-right: 0.75rem;
    object-fit: cover;
  }
  .username {
    font-weight: bold;
  }
  .post-content {
    margin-top: 0.5rem;
  }
  .post-media img, .post-media video {
    max-width: 100%;
    border-radius: 6px;
    margin-top: 0.5rem;
  }
  .comments-section {
    margin-top: 1rem;
    border-top: 1px solid #ccc;
    padding-top: 0.5rem;
  }
  .comment {
    background: #eee;
  }
  .reaction-bar {
    margin-top: 0.5rem;
  }
  .reaction-bar button {
    margin-right: 0.5rem;
    background: #e4e6eb;
    color: #050505;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    border: none;
    cursor: pointer;
  }
  .reaction-bar button.liked {
    background: #4267B2;
    color: white;
  }
  #wallet-section {
    margin-bottom: 1rem;
    border-bottom: 2px solid #ddd;
    padding-bottom: 1rem;
  }
</style>
</head>
<body>

<header>
  <h1>DRF Social DApp</h1>
</header>

<main>
  <section id="wallet-section">
    <h2>Wallet</h2>
    <div id="wallet-controls">
      <button id="btnCreateWallet">Create New Wallet</button>
      <button id="btnImportWallet">Import Wallet (Private Key)</button>
    </div>
    <div id="wallet-info" style="display:none;">
      <p><strong>Address:</strong> <span id="walletAddress"></span></p>
      <p><strong>Balance:</strong> <span id="walletBalance"></span> ETH</p>
      <button id="btnDisconnect">Disconnect Wallet</button>
    </div>
    <div id="wallet-import-section" style="display:none; margin-top:1rem;">
      <textarea id="privateKeyInput" placeholder="Paste your private key here"></textarea>
      <button id="btnImportPK">Import</button>
      <button id="btnCancelImport">Cancel</button>
    </div>
  </section>

  <section id="profile-section" style="display:none;">
    <h2>Your Profile</h2>
    <input type="text" id="profileUsername" placeholder="Username (required)" />
    <input type="text" id="profileDisplayName" placeholder="Display Name" />
    <input type="text" id="profileBio" placeholder="Bio" />
    <input type="text" id="profileAvatar" placeholder="Avatar URL" />
    <button id="btnSaveProfile">Save Profile</button>
  </section>

  <section id="newpost-section" style="display:none; margin-top:2rem;">
    <h2>Create a Post</h2>
    <textarea id="postContent" placeholder="Write something..."></textarea>
    <input type="file" id="postMedia" accept="image/*,video/*" />
    <button id="btnPost" disabled>Post</button>
  </section>

  <section id="feed-section" style="margin-top:2rem;">
    <h2>Feed</h2>
    <div id="postsContainer">Loading posts...</div>
    <button id="btnLoadMore" style="margin-top:1rem;">Load More</button>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
<script>
(async () => {

  // ==== CONFIGURATION ====
  const INFURA_PROJECT_ID = "YOUR_INFURA_PROJECT_ID"; // Replace with your Infura project ID
  const CONTRACT_ADDRESS = "YOUR_CONTRACT_ADDRESS";   // Replace with your deployed DRF Social contract address
  const CONTRACT_ABI = [/* Your Contract ABI JSON here */]; // Replace with your contract ABI

  // For IPFS upload (using public IPFS gateway here for demo)
  async function uploadToIPFS(file) {
    // Simple anonymous upload via Pinata public API or Infura IPFS API recommended for production
    // Here we just simulate for demo: use real upload for your project
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onloadend = () => {
        // Normally you upload reader.result to IPFS here
        resolve("ipfs://" + "QmFakeHashForDemo" + file.name); // Fake IPFS hash
      };
      reader.onerror = reject;
      reader.readAsArrayBuffer(file);
    });
  }

  // ==== STATE ====
  let provider;
  let signer;
  let wallet;
  let contract;
  let userAddress = null;
  let userProfile = null;
  let posts = [];
  let postsPage = 0;
  const POSTS_PER_PAGE = 5;

  // ==== DOM ELEMENTS ====
  const walletControls = document.getElementById("wallet-controls");
  const walletInfo = document.getElementById("wallet-info");
  const walletAddressEl = document.getElementById("walletAddress");
  const walletBalanceEl = document.getElementById("walletBalance");
  const btnDisconnect = document.getElementById("btnDisconnect");

  const btnCreateWallet = document.getElementById("btnCreateWallet");
  const btnImportWallet = document.getElementById("btnImportWallet");
  const walletImportSection = document.getElementById("wallet-import-section");
  const privateKeyInput = document.getElementById("privateKeyInput");
  const btnImportPK = document.getElementById("btnImportPK");
  const btnCancelImport = document.getElementById("btnCancelImport");

  const profileSection = document.getElementById("profile-section");
  const profileUsernameInput = document.getElementById("profileUsername");
  const profileDisplayNameInput = document.getElementById("profileDisplayName");
  const profileBioInput = document.getElementById("profileBio");
  const profileAvatarInput = document.getElementById("profileAvatar");
  const btnSaveProfile = document.getElementById("btnSaveProfile");

  const newPostSection = document.getElementById("newpost-section");
  const postContentInput = document.getElementById("postContent");
  const postMediaInput = document.getElementById("postMedia");
  const btnPost = document.getElementById("btnPost");

  const postsContainer = document.getElementById("postsContainer");
  const btnLoadMore = document.getElementById("btnLoadMore");

  // ==== HELPERS ====

  function saveProfileToLocal() {
    const profile = {
      username: profileUsernameInput.value.trim(),
      displayName: profileDisplayNameInput.value.trim(),
      bio: profileBioInput.value.trim(),
      avatar: profileAvatarInput.value.trim(),
    };
    localStorage.setItem("drfProfile_" + user
