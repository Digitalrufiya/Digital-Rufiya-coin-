<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DRF Social</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; margin: 0; }
    header { background: #222; padding: 15px; text-align: center; font-size: 1.5em; }
    #feed { max-width: 700px; margin: auto; padding: 20px; }
    .post { background: #1e1e1e; padding: 15px; margin-bottom: 15px; border-radius: 10px; }
    .post img, video { max-width: 100%; border-radius: 10px; margin-top: 10px; }
    .post-header { display: flex; align-items: center; gap: 10px; }
    .profile-pic { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
    .reaction-btn { cursor: pointer; margin-right: 8px; font-size: 1.2em; }
    .comment { margin-left: 15px; font-size: 0.9em; color: #ccc; }
    .filters button { margin-right: 5px; }
    #newPost input, #newPost textarea { width: 100%; margin-top: 10px; padding: 10px; border-radius: 5px; border: none; background: #333; color: #fff; }
    #newPost button { margin-top: 10px; width: 100%; padding: 10px; background: #007bff; border: none; color: white; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>

<header>DRF Social</header>

<div id="usernameModal" style="display: none; text-align: center; padding: 40px;">
  <h2>Create Username</h2>
  <input type="text" id="usernameInput" placeholder="Enter username" />
  <br><br>
  <label>Upload Profile Picture:</label><br>
  <input type="file" id="profilePicInput" accept="image/*" />
  <br><br>
  <button onclick="saveUsername()">Continue</button>
</div>

<div id="feed" style="display: none;">
  <div id="newPost">
    <textarea id="postText" placeholder="Write something..."></textarea>
    <input type="text" id="postMedia" placeholder="Media URL (image/video/link)" />
    <button onclick="createPost()">Post</button>
  </div>

  <div class="filters">
    <p>Filter posts: 
      <button onclick="setFilter('all')">All</button>
      <button onclick="setFilter('image')">Images</button>
      <button onclick="setFilter('video')">Videos</button>
      <button onclick="setFilter('link')">Links</button>
    </p>
  </div>

  <hr>
  <div id="posts"></div>
</div>

<script>
let username = localStorage.getItem("drf_username");
let profilePic = localStorage.getItem("drf_profile_pic");
let posts = JSON.parse(localStorage.getItem("drf_posts") || "[]");
let filter = "all";

if (!username) {
  document.getElementById("usernameModal").style.display = "block";
} else {
  document.getElementById("feed").style.display = "block";
  loadPosts();
}

function saveUsername() {
  const uname = document.getElementById("usernameInput").value.trim();
  if (uname.length < 3) return alert("Username too short.");
  const picInput = document.getElementById("profilePicInput");
  if (picInput.files[0]) {
    const reader = new FileReader();
    reader.onload = function (e) {
      localStorage.setItem("drf_username", uname);
      localStorage.setItem("drf_profile_pic", e.target.result);
      location.reload();
    };
    reader.readAsDataURL(picInput.files[0]);
  } else {
    localStorage.setItem("drf_username", uname);
    location.reload();
  }
}

function createPost() {
  const text = document.getElementById("postText").value;
  const media = document.getElementById("postMedia").value;
  const type = media.includes("jpg") || media.includes("png") ? "image" :
               media.includes("mp4") || media.includes("webm") ? "video" :
               media.startsWith("http") ? "link" : "text";

  posts.unshift({
    username: username,
    profilePic: profilePic,
    text: text,
    media: media,
    type: type,
    time: new Date().toLocaleString(),
    comments: [],
    reactions: {}
  });
  localStorage.setItem("drf_posts", JSON.stringify(posts));
  document.getElementById("postText").value = "";
  document.getElementById("postMedia").value = "";
  loadPosts();
}

function loadPosts() {
  const container = document.getElementById("posts");
  container.innerHTML = "";
  posts.forEach((post, i) => {
    if (filter !== "all" && post.type !== filter) return;
    const div = document.createElement("div");
    div.className = "post";
    div.innerHTML = `
      <div class="post-header">
        <img src="${post.profilePic || ''}" class="profile-pic" />
        <strong>@${post.username}</strong>
        <small style="margin-left:auto; font-size:0.8em;">${post.time}</small>
      </div>
      <p>${post.text}</p>
      ${renderMedia(post)}
      <div>
        ${renderReactions(post, i)}
        <input type="text" placeholder="Add comment..." onkeypress="addComment(event, ${i})" />
        ${post.comments.map(c => `<div class="comment"><strong>@${c.user}</strong>: ${c.text}</div>`).join("")}
      </div>
    `;
    container.appendChild(div);
  });
}

function renderMedia(post) {
  if (post.type === "image") return `<img src="${post.media}" />`;
  if (post.type === "video") return `<video controls src="${post.media}"></video>`;
  if (post.type === "link") return `<a href="${post.media}" target="_blank">${post.media}</a>`;
  return "";
}

function renderReactions(post, index) {
  const emojis = ["👍", "❤️", "😂", "😢", "😡"];
  return emojis.map(e =>
    `<span class="reaction-btn" onclick="react('${e}', ${index})">${e} ${post.reactions[e] || 0}</span>`
  ).join("");
}

function react(emoji, index) {
  posts[index].reactions[emoji] = (posts[index].reactions[emoji] || 0) + 1;
  localStorage.setItem("drf_posts", JSON.stringify(posts));
  loadPosts();
}

function addComment(e, index) {
  if (e.key === "Enter") {
    const text = e.target.value.trim();
    if (!text) return;
    posts[index].comments.push({ user: username, text });
    e.target.value = "";
    localStorage.setItem("drf_posts", JSON.stringify(posts));
    loadPosts();
  }
}

function setFilter(f) {
  filter = f;
  loadPosts();
}
</script>

</body>
</html>
