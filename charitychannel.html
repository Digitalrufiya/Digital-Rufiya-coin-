<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Charity Request</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 500px; margin: auto; }
    input, button { display: block; width: 100%; padding: 10px; margin-bottom: 10px; }
    .status { margin-top: 10px; color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h2>Charity Request Form</h2>

  <input type="text" id="name" placeholder="Your Name" required />
  <input type="text" id="wallet" placeholder="BSC Wallet Address (0x...)" required />
  <input type="text" id="country" placeholder="Country" required />
  <input type="number" id="amount" placeholder="Requested Amount" required />
  <button onclick="submitRequest()">Send Request</button>

  <div id="loginStatus"></div>
  <div class="status" id="statusMessage"></div>

  <script>
    // ‚úÖ Replace with your Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);

    // üë§ Anonymous auth
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        document.getElementById("loginStatus").innerText = "‚úÖ Logged in as: " + user.uid;
      } else {
        firebase.auth().signInAnonymously()
          .catch(error => {
            document.getElementById("statusMessage").innerText = "‚ùå Auth error: " + error.message;
          });
      }
    });

    function isValidWallet(addr) {
      return /^0x[a-fA-F0-9]{40}$/.test(addr);
    }

    function submitRequest() {
      const name = document.getElementById("name").value.trim();
      const wallet = document.getElementById("wallet").value.trim();
      const country = document.getElementById("country").value.trim();
      const amount = parseFloat(document.getElementById("amount").value.trim());
      const statusMsg = document.getElementById("statusMessage");

      if (!name || !wallet || !country || isNaN(amount)) {
        statusMsg.innerText = "‚ùå Please fill all fields correctly.";
        statusMsg.className = "error";
        return;
      }

      if (!isValidWallet(wallet)) {
        statusMsg.innerText = "‚ùå Invalid BSC Wallet Address.";
        statusMsg.className = "error";
        return;
      }

      const user = firebase.auth().currentUser;
      if (!user) {
        statusMsg.innerText = "‚ùå Not authenticated. Try again.";
        statusMsg.className = "error";
        return;
      }

      const request = {
        name: name,
        wallet_address: wallet,
        country: country,
        amount: amount,
        request_time: new Date().toISOString()
      };

      firebase.database().ref("charityRequests").push(request)
        .then(() => {
          statusMsg.innerText = "‚úÖ Request sent successfully!";
          statusMsg.className = "status";
        })
        .catch((error) => {
          statusMsg.innerText = "‚ùå Firebase error: " + error.message;
          statusMsg.className = "error";
        });
    }
  </script>
</body>
</html>
