<!DOCTYPE html>
<html>
  <head>
    <title>Post Upload</title>
  </head>
  <body>
    <h3>Create a Post</h3>
    <input type="file" id="file" accept="image/*,video/*" /><br /><br />
    <input type="text" id="author" placeholder="Your name" required /><br /><br />
    <textarea id="content" placeholder="Say something..." required></textarea><br /><br />
    <button onclick="upload()">Post</button>

    <p id="status"></p>

    <script>
      async function upload() {
        const fileInput = document.getElementById("file");
        const file = fileInput.files[0];
        const author = document.getElementById("author").value.trim();
        const content = document.getElementById("content").value.trim();
        const status = document.getElementById("status");

        if (!author || !content) {
          status.innerText = "❌ Author and content are required.";
          return;
        }

        if (!file) {
          status.innerText = "❌ Please select a file.";
          return;
        }

        const reader = new FileReader();
        reader.onloadend = async function () {
          const base64 = reader.result.split(",")[1]; // remove base64 prefix
          const payload = {
            author: author,
            avatar: "https://i.imgur.com/abc123.png", // optional
            content: content,
            mediaName: file.name,
            mediaBase64: base64,
          };

          try {
            const res = await fetch("https://script.google.com/macros/s/AKfycbw5woEH6Yrh6PNWbiyMhIOuglpQ6UuiGFX0sI8OuS0caSOJd6jpgqekBKFFhBPgFPrA/exec", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });

            const result = await res.json();
            if (result.status === "success") {
              status.innerText = "✅ Post uploaded successfully!";
            } else {
              status.innerText = "❌ Error from server: " + result.message;
            }
          } catch (err) {
            status.innerText = "❌ Failed to post: " + err.message;
          }
        };

        reader.readAsDataURL(file);
        status.innerText = "⏳ Uploading...";
      }
    </script>
  </body>
</html>
