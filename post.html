<!DOCTYPE html>
<html>
  <body>
    <h3>DRF Mini Facebook Posts</h3>
    <input type="file" id="file" /><br/>
    <input type="text" id="author" placeholder="Your name" /><br/>
    <textarea id="content" placeholder="Say something..."></textarea><br/>
    <button onclick="upload()">Post</button>

    <script>
      async function upload() {
        const fileInput = document.getElementById("file");
        const file = fileInput.files[0];
        const author = document.getElementById("author").value.trim();
        const content = document.getElementById("content").value.trim();

        if(!author){
          alert('Please enter your name');
          return;
        }
        if(!content && !file){
          alert('Please enter content or select a photo');
          return;
        }

        let mediaBase64 = '';
        let mediaName = '';

        if(file){
          mediaName = file.name;
          mediaBase64 = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onloadend = () => {
              resolve(reader.result.split(',')[1]);
            };
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
        }

        const payload = {
          author,
          avatar: 'https://i.imgur.com/abc123.png', // You can replace with dynamic avatars
          content,
          mediaName,
          mediaBase64
        };

        try {
          const res = await fetch('https://script.google.com/macros/s/AKfycbz97g2aAC7Po3mK4GVz5jsiRLNVw76d2jLnx44JDnyL221Gv6jZ60xscWWD4BOxxXyL/exec', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          const data = await res.json();
          if(data.status === 'success'){
            alert('Post uploaded successfully!');
            // Optionally clear inputs
            fileInput.value = '';
            document.getElementById("author").value = '';
            document.getElementById("content").value = '';
          } else {
            alert('Error: ' + data.message);
          }
        } catch(e){
          alert('Network or server error');
          console.error(e);
        }
      }
    </script>
  </body>
</html>
